# GitHub Copilot Instructions - CIDR Subnet Calculator

This file provides instructions and context for GitHub Copilot and AI agents working on the CIDR Subnet Calculator project.

## Project Overview

**CIDR Subnet Calculator** is a modern web application for calculating subnet details, splitting CIDR ranges recursively, and planning network configurations.

### Core Features
- Subnet calculation with detailed network information
- Recursive splitting of networks down to /32 (single host)
- Interactive table with expand/collapse functionality
- Copy-to-clipboard for all field values
- CSV export of selected rows
- Dark/Light mode support
- Responsive design

### Key Project Goals
1. Provide accurate CIDR subnet calculations for network engineers
2. Maintain a clean, modern, and performant user interface
3. Ensure no horizontal scrollbars on standard desktop displays
4. Support bulk operations (select all, CSV export)
5. Security by design - no database, no sensitive data, client-side logic

## Technology Stack

### Frontend
- React 18 with TypeScript
- Tailwind CSS for styling
- shadcn/ui component library (Radix UI primitives)
- React Hook Form with Zod validation
- Vite for bundling and development
- Tanstack React Query for data fetching

### Backend
- Express.js 5 with TypeScript
- Node.js runtime
- No database (in-memory only)
- Static file serving from `dist/public`

### Development Tools
- TypeScript with strict mode
- Drizzle ORM (configured but not in use currently)
- Tailwind CSS with PostCSS
- tsx for TypeScript execution

## Project Structure

```
client/
  ├── src/
  │   ├── App.tsx           # Main application component
  │   ├── main.tsx          # React entry point
  │   ├── index.css         # Global styles including elegant-scrollbar
  │   ├── components/       # Reusable UI components
  │   │   └── ui/          # shadcn/ui components
  │   ├── hooks/            # React hooks
  │   │   ├── use-mobile.tsx
  │   │   └── use-toast.ts
  │   ├── lib/              # Utility functions
  │   │   ├── subnet-utils.ts   # Core CIDR calculation logic
  │   │   ├── queryClient.ts    # React Query configuration
  │   │   └── utils.ts          # Helper functions
  │   └── pages/            # Page components
  ├── index.html            # HTML entry point
  └── public/               # Static assets

server/
  ├── index.ts              # Express server setup with fallback listen logic
  ├── routes.ts             # API route definitions
  ├── vite.ts               # Vite dev server integration
  ├── static.ts             # Static file serving
  └── storage.ts            # In-memory storage

shared/
  └── schema.ts             # Shared TypeScript types/schemas

script/
  └── build.ts              # Build script

Root Config Files:
  ├── tsconfig.json         # TypeScript configuration
  ├── vite.config.ts        # Vite configuration
  ├── tailwind.config.ts    # Tailwind CSS customization
  ├── postcss.config.js     # PostCSS configuration
  ├── package.json          # Dependencies and scripts
  └── drizzle.config.ts     # Drizzle ORM configuration
```

## Current Development State

### Completed Features (from agent-reasoning.md)
1. Core CIDR subnet calculation functionality
2. Interactive table with expand/collapse for split subnets
3. Copy-to-clipboard for all field values
4. Example buttons for quick testing
5. Network Overview card with key statistics
6. UI refinements for compact display (no horizontal scrollbars)
7. Elegant custom scrollbar styling
8. CSV export functionality with row selection
9. Select All checkbox for bulk operations
10. Author attribution with GitHub profile link

### Known Issues & Solutions
1. **Server Binding Issue (RESOLVED)**
   - Windows environment doesn't support `0.0.0.0` binding
   - **Solution**: Fallback mechanism in `server/index.ts` tries hosts in order:
     - First: `127.0.0.1` (IPv4 localhost)
     - Second: `localhost` (system-dependent resolution)
   - Automatically logs which host was successfully bound

2. **TypeScript Type Definitions (RESOLVED)**
   - Missing `@types/node` and `vite/client` definitions
   - **Solution**: Install with `npm.cmd install --save-dev @types/node vite`

3. **Windows npm Script Issue (RESOLVED)**
   - Cannot use `NODE_ENV=development` syntax on Windows cmd
   - **Solution**: Using `cross-env` package to set environment variables cross-platform

## Running the Project

### Development
```bash
npm.cmd install              # Install dependencies (Windows)
npm.cmd run dev             # Start development server with hot reload
```

The dev server will attempt to bind to `127.0.0.1:5000` or `localhost:5000`.

### Production
```bash
npm.cmd run build           # Build for production
npm.cmd run start           # Start production server
```

### Type Checking
```bash
npm.cmd run check           # Run TypeScript type checker
```

## Code Style & Conventions

### Component Structure
- Use functional components with hooks
- Prefer React Hook Form for forms with Zod validation
- Use shadcn/ui components as the base UI library
- Always use TypeScript - no implicit `any`

### File Naming
- Components: PascalCase (e.g., `Calculator.tsx`)
- Utilities: camelCase (e.g., `subnet-utils.ts`)
- Styles: Include in component files or global `index.css`

### Type Safety
- `tsconfig.json` has `strict: true` - all code must be type-safe
- Use `@types/*` packages for third-party library types
- Leverage TypeScript for self-documenting code

### CSS & Tailwind
- Use Tailwind utility classes exclusively
- Custom styles in `index.css` only for reusable patterns
- Example: `.elegant-scrollbar` for styled scrollbars
- Support both light and dark modes using Tailwind classes

### Icons & User-Facing Text
- **Use Lucide React icons only** - do not use unicode icons or special characters
- All icons must come from the lucide-react package
- This ensures consistency, accessibility, and proper rendering across all platforms/browsers
- Exception: Status text messages and labels are fine; only the visual icon elements must use Lucide

## Subnet Calculation Logic

The core subnet calculation logic is in [client/src/lib/subnet-utils.ts](client/src/lib/subnet-utils.ts).

### Key Functions
- `calculateSubnet()`: Calculate all subnet information from CIDR notation
- Network address, broadcast address, host range calculation
- Validation of CIDR notation and IP address format
- Recursive subnet splitting down to /32

### Validation
- Uses Zod schema for input validation
- CIDR notation must be in format: `x.x.x.x/prefix` where prefix is 0-32

## CSV Export Implementation

CSV export includes all subnet details:
- CIDR notation
- Network Address
- Broadcast Address
- First Host
- Last Host
- Usable Hosts
- Total Hosts
- Subnet Mask
- Wildcard Mask
- Prefix Length

File naming format: `subnet-export-YYYY-MM-DD.csv`

## Agent Orchestration Guidelines

### For AI Agents Working on This Project

1. **Always Maintain Type Safety**
   - TypeScript strict mode is enabled
   - No `any` types without justification
   - Test type checking with `npm.cmd run check`

2. **Cross-Platform Compatibility**
   - Test solutions on Windows (primary development environment)
   - Use `cross-env` for environment variables in scripts
   - Avoid platform-specific path handling

3. **Performance Considerations**
   - All subnet calculations happen client-side
   - No database queries or network requests for core functionality
   - Optimize table rendering with React best practices
   - Monitor component re-renders

4. **UI/UX Standards**
   - No horizontal scrollbars on standard displays
   - Elegant, modern design aligned with shadcn/ui
   - Copy-to-clipboard feedback for user interactions
   - Responsive design that works on mobile

5. **Testing Changes**
   - Run `npm.cmd run dev` to test locally
   - Verify TypeScript compilation: `npm.cmd run check`
   - Check for console errors in browser DevTools
   - Test both light and dark modes

6. **Code Review Checklist**
   - [ ] TypeScript compilation passes without errors
   - [ ] No console warnings or errors
   - [ ] No horizontal scrollbars on 1080p+ screens
   - [ ] All features work in both light and dark modes
   - [ ] Changes follow existing code style
   - [ ] No security vulnerabilities introduced

## Security Principles

- **No User Data**: All calculations are ephemeral, no storage or transmission
- **Client-Side Only**: All subnet logic executes in the browser
- **Helmet Middleware**: Adds XSS, clickjacking, and MIME sniffing protection
- **Static Serving**: Production only serves compiled assets from `dist/public`
- **No APIs**: No external API calls except for static assets

## Common Tasks

### Adding a New Feature
1. Create component in `client/src/components/`
2. Add TypeScript types to `shared/schema.ts` if needed
3. Use React Hook Form + Zod for form validation
4. Style with Tailwind CSS
5. Test with `npm.cmd run dev`
6. Update this file and `agent-reasoning.md` with feature description

### Fixing a Bug
1. Identify exact file and line where issue occurs
2. Write minimal reproduction if possible
3. Fix the issue maintaining type safety
4. Test in dev environment
5. Verify no regressions in related features
6. Update `agent-reasoning.md` with issue and solution

### Performance Optimization
1. Profile with React DevTools
2. Check for unnecessary re-renders
3. Optimize memoization of expensive calculations
4. Test with large subnet hierarchies (many splits)
5. Verify no lag or UI freezing

## Helpful Links

- [agent-reasoning.md](agent-reasoning.md) - Detailed development history and prompts
- [README.md](README.md) - User-facing project documentation
- [Tailwind CSS Docs](https://tailwindcss.com)
- [shadcn/ui Components](https://ui.shadcn.com)
- [React Hook Form Docs](https://react-hook-form.com)
- [TypeScript Handbook](https://www.typescriptlang.org/docs)

## Planned Features & API Enhancements

### Backend API Layer (Future)

Currently all subnet calculations happen client-side. The following REST API endpoints are planned for future implementation:

**POST `/api/subnets/calculate`**
- Calculate subnet details from CIDR notation
- Request: `{ cidr: "192.168.1.0/24" }`
- Response: Full `SubnetInfo` object with all network details
- Use cases: External tools, programmatic access, server-side validation

**POST `/api/subnets/split`**
- Split a subnet into two equal child subnets
- Request: `{ subnet: SubnetInfo }`
- Response: `{ first: SubnetInfo, second: SubnetInfo }`
- Use cases: Batch subnet planning, network automation scripts

**POST `/api/subnets/batch`**
- Calculate multiple subnets in a single request
- Request: `{ cidrs: ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"] }`
- Response: Array of `SubnetInfo` objects
- Use cases: Network documentation generation, bulk operations

**Benefits of Adding API Layer:**
- Enable external applications to use the calculator
- Server-side logging and usage analytics
- Potential caching of frequently requested calculations
- Integration with network management tools
- Standardized interface for subnet operations

**Implementation Notes:**
- Share calculation logic with client-side code (`subnet-utils.ts`)
- Add request/response validation using existing Zod schemas
- Implement error handling for invalid CIDR inputs
- No database needed - calculations are stateless
- Rate limiting optional (security consideration)

## Latest Status

**As of January 31, 2026:**
- Development server running on localhost
- All TypeScript type definitions installed
- Core functionality complete and tested
- Server binding fallback logic implemented
- Robustness improvements (validation, error boundaries, state validation)
- Toast duration optimized for better UX
- Ready for API implementation and future enhancements

---

**Last Updated**: January 31, 2026  
**Maintained By**: Development Team  
**Related Files**: [agent-reasoning.md](agent-reasoning.md), [README.md](README.md)
